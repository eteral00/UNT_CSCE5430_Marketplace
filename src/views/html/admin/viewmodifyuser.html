<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>User Account Management</title>
    
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>


    <script>
         $(document).ready(function() {
			
			// clean URL
			var url = window.location.toString();
			if (url.indexOf("?") > 0) {
				var clean_url = url.substring(0, url.indexOf("?"));
				window.history.replaceState({}, document.title, clean_url);
			}
			
			// clean input validate msg
			$("#message_text").empty();

			// validate input before submitting POST-request
			$("#modify_user").click( function(event) {

				// clean input validate msg
				$("#message_text").empty();

				// validate input
				var userName = $("#user_name").val().trim();
				var flexSwitchCheckDefault = $("#flexSwitchCheckDefault").val().trim();
				
				var anyErrors = false;
                console.log("===>"+userName,flexSwitchCheckDefault)
				
				// all fields are empty, nothing to edit
				if ( flexSwitchCheckDefault === "") {
					$("#message_text").append("<p>Error: Nothing to edit!</p>" );
					anyErrors = true;
				} else {
					// validate username not empty
                    if ( userName === "" ) {
                        $("#message_text").append("<p>Error: Username cannot be empty! Please enter Username!</p>" );
                        anyErrors = true;
                    }			
				}

				// if error, prevent submit
				if (anyErrors){
					event.preventDefault();
				} else {
					// no error, submit POST-request
					$.ajax({
						method : "PUT",
						url : "/admin/modify_user",
						data : {
							userName: userName,
							flexSwitchCheckDefault: flexSwitchCheckDefault
						},
						dataType: "json",
						success: function(result){
							// alert(result.message);
                            console.log("error in message1")
							$("#message_text").empty();
							$("#message_text").html(result.message);
						},
						error: function(xhr, status, err){
                            console.log("error in message101")
							$("#message_text").empty();
							// var errorMsg = xhr.responseJSON.message;
							// $("#message_text").html(errorMsg);
						},
						complete: function() {
							$("#user_name").val("");
							$("#flexSwitchCheckDefault").val("");
						}
					});
				}				
			} );

            $("#delete_user").click( function(event) {

                // clean input validate msg
                $("#message_text").empty();

                // validate input
                var userName = $("#user_name").val().trim();

                var anyErrors = false;
                console.log("===>"+userName)

                // validate username not empty
                if ( userName === "" ) {
                    $("#message_text").append("<p>Error: Username cannot be empty! Please enter Username!</p>" );
                    anyErrors = true;
                }

                // if error, prevent submit
                if (anyErrors){
                    event.preventDefault();
                } else {
                    // no error, submit POST-request
                    $.ajax({
                        method : "PUT",
                        url : "/admin/delete_user",
                        data : {
                            userName: userName,
                        },
                        dataType: "json",
                        success: function(result){
                            // alert(result.message);
                            console.log("error in message1")
                            $("#message_text").empty();
                            $("#message_text").html(result.message);
                        },
                        error: function(xhr, status, err){
                            console.log("error in message101")
                            $("#message_text").empty();
                            // var errorMsg = xhr.responseJSON.message;
                            // $("#message_text").html(errorMsg);
                        },
                        complete: function() {
                            $("#user_name").val("");
                            $("#flexSwitchCheckDefault").val("");
                        }
                    });
                }				
            } );

		});	
    </script>

</head>

<body>
    <div class="container-sm bg-light w-50 align-items-center pt-5 mx-auto">
        <div style="float:right">
            <label class="logout" for="admin_logout">
                <button type="button" class="btn-primary" name="admin_logout" id="admin_logout" value="LOGOUT" 
                    onclick="location.href = '../logout';">LOGOUT</button>
            </label>
        </div>

        <h4 class="container-sm mx-auto"><b>VIEW AND MODIFY Users </b></h4>
        
            <div class="form-group pt-3">
                <label class="form-label">ENTER USER NAME</label>
                <input type="text" id = "user_name" class="form-control" style="width:50%" required="true">
            </div>

            <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" name="flexSwitchCheckDefault" id="flexSwitchCheckDefault" />
                <label class="form-check-label" for="flexSwitchCheckDefault">Block User</label>
            </div> 

            <div class="align">
                <h3 id="message_text"></h3>
            </div>

            <div class="container-sm pl-5 pt-5 mx-auto">
                <button type="button" name ="go_back" value="Go Back" class="btn-primary "
                    onclick="location.href = 'admindashboard';">Go Back</button>
                <button type="button" name="modify_user" id="modify_user" class="modify btn-secondary ">Modify User</button>
                <button type="button" id="delete_user" class="delete btn-secondary ">Delete User</button>
            </div> 
    </div>
    
</bosdy>
</html>
