<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>view and modify user</title>
    
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>


    <script>
         $(document).ready(function() {
			
			// clean URL
			var url = window.location.toString();
			if (url.indexOf("?") > 0) {
				var clean_url = url.substring(0, url.indexOf("?"));
				window.history.replaceState({}, document.title, clean_url);
			}
			
			// clean input validate msg
			$("#message_text").empty();

			// validate input before submitting POST-request
			$("#modify_user").click( function(event) {

				// clean input validate msg
				$("#message_text").empty();

				// validate input
				var userName = $("#user_name").val().trim();
				var flexSwitchCheckDefault = $("#flexSwitchCheckDefault").val().trim();
				
				var anyErrors = false;
                console.log("===>"+userName,flexSwitchCheckDefault)
				
				// all fields are empty, nothing to edit
				if ( flexSwitchCheckDefault === "") {
					$("#message_text").append("<p>Error: New Password is empty. Nothing to update!</p>" );
					anyErrors = true;
				} else {
					// validate new password is different from current password
					if ( flexSwitchCheckDefault === userName ) {
						$("#message_text").append("<p>Error: New Password is the same as current Password! Nothing to update!</p>" );
						anyErrors = true;
					}

					// validate current password not empty
					if ( userName === "" ) {
						$("#message_text").append("<p>Error: Current Password cannot be empty! Please enter your current Password!</p>" );
						anyErrors = true;
					}

					
				}

				// if error, prevent submit
				if (anyErrors){
					event.preventDefault();
				} else {
					// no error, submit POST-request
					$.ajax({
						method : "PUT",
						url : "/admin/modify_user",
						data : {
							userName: userName,
							flexSwitchCheckDefault: flexSwitchCheckDefault
						},
						dataType: "json",
						success: function(result){
							// alert(result.message);
                            console.log("error in message1")
							$("#message_text").empty();
							$("#message_text").html(result.message);
						},
						error: function(xhr, status, err){
                            console.log("error in message101")
							$("#message_text").empty();
							// var errorMsg = xhr.responseJSON.message;
							// $("#message_text").html(errorMsg);
						},
						complete: function() {
							$("#user_name").val("");
							$("#flexSwitchCheckDefault").val("");
						}
					});
				}				
			} );

            $("#delete_user").click( function(event) {

        // clean input validate msg
        $("#message_text").empty();

        // validate input
        var userName = $("#user_name").val().trim();

        var anyErrors = false;
        console.log("===>"+userName)

        // all fields are empty, nothing to edit

            // validate current password not empty
            if ( userName === "" ) {
                $("#message_text").append("<p>Error: Current Password cannot be empty! Please enter your current Password!</p>" );
                anyErrors = true;
            }

            

        // if error, prevent submit
        if (anyErrors){
            event.preventDefault();
        } else {
            // no error, submit POST-request
            $.ajax({
                method : "PUT",
                url : "/admin/delete_user",
                data : {
                    userName: userName,
                },
                dataType: "json",
                success: function(result){
                    // alert(result.message);
                    console.log("error in message1")
                    $("#message_text").empty();
                    $("#message_text").html(result.message);
                },
                error: function(xhr, status, err){
                    console.log("error in message101")
                    $("#message_text").empty();
                    // var errorMsg = xhr.responseJSON.message;
                    // $("#message_text").html(errorMsg);
                },
                complete: function() {
                    $("#user_name").val("");
                    $("#flexSwitchCheckDefault").val("");
                }
            });
        }				
        } );

		});	
    </script>

</head>

<body>
    <div class="container-sm bg-light w-50 align-items-center pt-5 mx-auto">
        <div style="float:right">
            <form align="right" name="form" method="post" action="login.html">
                <label class="logout">
                <input name="submitt" type="submit" id="submitt" value="log out">
                </label>
            </form>
        </div>

        <h4 class="container-sm mx-auto"><b>VIEW AND MODIFY Users </b></h4>
        
        <form method ="GET" >
            <div class="form-group pt-3">
                <label class="form-label">ENTER USER NAME</label>
                <input type="text" id = "user_name" class="form-control" style="width:50%" required="true">
            </div>

            <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" name="flexSwitchCheckDefault" id="flexSwitchCheckDefault" />
                <label class="form-check-label" for="flexSwitchCheckDefault">Block User</label>
            </div> 

            <div class="align">
                <h3 id="message_text"></h3>
            </div>

            <div class="container-sm pl-5 pt-5 mx-auto">
                <button type="submit" name="modify_user" id="modify_user" class="modify btn-secondary ">Modify User</button>
                <button type="submit" id="delete_user" class="delete btn-secondary ">Delete User</button>
                <button type="submit" onclick="location.href = 'admindashboard.html';" formaction="admindashboard.html" name ="action" value="Go Back" class="delete btn-secondary ">Go Back</button>
            </div> 

        </form>
    </div>
    
</bosdy>
</html>
