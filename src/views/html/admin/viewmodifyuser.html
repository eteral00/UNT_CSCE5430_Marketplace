<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>view and modify user</title>
    
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel ="stylesheet" type="text/css" href="../css/product_style.css"/>

    <script>
         $(document).ready(function() {
			
			// clean URL
			var url = window.location.toString();
			if (url.indexOf("?") > 0) {
				var clean_url = url.substring(0, url.indexOf("?"));
				window.history.replaceState({}, document.title, clean_url);
			}
			
			// clean input validate msg
			$("#message_text").empty();

			// validate input before submitting POST-request
			$("#modify_user").click( function(event) {

				// clean input validate msg
				$("#message_text").empty();

				// validate input
				var userName = $("#user_name").val().trim();
				var newPassword = $("#new_password").val().trim();
				var confirmPassword = $("#confirm_password").val().trim();
				
				var anyErrors = false;
				
				// all fields are empty, nothing to edit
				if ( newPassword === "") {
					$("#message_text").append("<p>Error: New Password is empty. Nothing to update!</p>" );
					anyErrors = true;
				} else {
					// validate new password is different from current password
					if ( newPassword === userName ) {
						$("#message_text").append("<p>Error: New Password is the same as current Password! Nothing to update!</p>" );
						anyErrors = true;
					}

					// validate current password not empty
					if ( userName === "" ) {
						$("#message_text").append("<p>Error: Current Password cannot be empty! Please enter your current Password!</p>" );
						anyErrors = true;
					}

					// validate length of new password field
					if (newPassword.length < 6){
						$("#message_text").append("<p>Error: New Password must be at least 6 characters!</p>" );
						anyErrors = true;
					}
					// validate password match
					if (newPassword !== confirmPassword){
						$("#message_text").append("<p>Error: New Password & Confirm Password do not match!</p>" );
						anyErrors = true;
					}
				}

				// if error, prevent submit
				if (anyErrors){
					event.preventDefault();
				} else {
					// no error, submit POST-request
					$.ajax({
						method : "PUT",
						url : "/admin/change_pass_admin",
						data : {
							userName: userName,
							newPassword: newPassword
						},
						dataType: "json",
						success: function(result){
							// alert(result.message);
                            console.log("error in message1")
							$("#message_text").empty();
							$("#message_text").html(result.message);
						},
						error: function(xhr, status, err){
                            console.log("error in message101")
							$("#message_text").empty();
							// var errorMsg = xhr.responseJSON.message;
							// $("#message_text").html(errorMsg);
						},
						complete: function() {
							$("#user_name").val("");
							$("#new_password").val("");
							$("#confirm_password").val("");
						}
					});
				}				
			} );
		});	
    </script>

</head>

<body>
    <div class="container-sm bg-light w-50 align-items-center pt-5 mx-auto">
        <div style="float:right">
            <form align="right" name="form" method="post" action="login.html">
                <label class="logout">
                <input name="submitt" type="submit" id="submitt" value="log out">
                </label>
            </form>
        </div>

        <h4 class="container-sm mx-auto"><b>VIEW AND MODIFY Users </b></h4>
        
        <form method ="GET" >
            <div class="form-group pt-3">
                <label class="form-label">ENTER USER NAME</label>
                <input type="text" class="form-control" style="width:50%" required="true">
            </div>

            <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" name="flexSwitchCheckDefault" id="flexSwitchCheckDefault" />
                <label class="form-check-label" for="flexSwitchCheckDefault">Block User</label>
            </div> 

            <div class="container-sm pl-5 pt-5 mx-auto">
                <button type="submit" onclick="location.href = 'adminmodifyuser.html';" formaction="adminmodifyuser.html" name="action" id="modify_user" value="Update"class="modify btn-secondary ">Modify User</button>
                <button type="submit" onclick="location.href = 'admindeleteuser.html';" formaction="admindeleteuser.html" name ="action" value="Delete" class="delete btn-secondary ">Delete User</button>
                <button type="submit" onclick="location.href = 'admindashboard.html';" formaction="admindashboard.html" name ="action" value="Go Back" class="delete btn-secondary ">Delete User</button>
            </div> 

        </form>
    </div>
    
</bosdy>
</html>
